'Open files
Private Sub openFile(iFilePath As String)
    
    'Dim iFilePath As String
    'sFile = "C:\docs\data.xlsx"
    
    'Use Dir to check if file exists
    If Dir(iFilePath) = vbNullString Then

        'if file does not exist display message
        MsgBox "Could not find the file " & iFilePath
        Exit Sub

    End If
    
    'Code will only reach here if file exists
    Workbooks.Open iFilePath
    
End Sub

'Convert .csv to .xlsx
Private Sub convertCsvToXlsx()

    Dim folderSelection As FileDialog: Set folderSelection = Application.FileDialog(msoFileDialogFolderPicker)
    
    With folderSelection
        .AllowMultiSelect = False
        .Title = "Select the folder with CSV Files"
        .Show
        If .SelectedItems.Count = 0 Then Exit Sub
    End With

    'error handling
    On Error GoTo errorHandler

    'set up loop through iPath
    Dim iFolder As String: iFolder = folderSelection.SelectedItems(1) & "\"
    Dim iExt As String: iExt = "*.csv"
    Dim iFile As String: iFile = Dir(iFolder & iExt)
    Dim iFileName As String
    Dim iFilePath As String: iFilePath = iFolder & iFile
    Dim iWorkbook As Workbook: Set iWorkbook = worksbooks.open(FileName:= iFilePath, ReadOnly:= True)

    For each wb in iWorkbook

        Call openFile(iFilePath)
        iFileName = CreateObject("Scripting.FileSystemObject").GetBaseName(iFile)

        'xlsx saveAs
        iWorkbook.SaveAs iFolder & iFileName & ".xlsx", FileFormat:=xlOpenXMLWorkbook
        
        'closes newly converted xlsx file
        ActiveWorkbook.Close savechanges:= False

        'deletes the csv file
        'Kill iFolder & iFileName

        iFile = Dir
    Next wb
        
    'Task completion message
    MsgBox "The task has completed", vbInformation, "Task Completion"

errorHandler:

    MsgBox "The following error has occurred: " & vbCrLf & vbCrLf & "Error Number:" & Err.Number & vbCrLf & _
    "Error Description: " & Err.Description, vbExclamation, "Error Message"

End Sub

